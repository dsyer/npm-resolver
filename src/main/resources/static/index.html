<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Demo</title>
	<meta name="description" content="" />
	<meta name="viewport" content="width=device-width" />
	<base href="/" />
	<link rel="stylesheet" type="text/css" href="/npm/bootstrap/dist/css/bootstrap.min.css" />
	<script async src="/npm/es-module-shims"></script>
	<script type="importmap">
		{
			"imports": {
				"bootstrap": "/npm/bootstrap",
				"@popperjs/core": "/npm/popperjs__core",
				"@hotwired/stimulus": "/npm/hotwired__stimulus",
				"@hotwired/turbo": "/npm/hotwired__turbo"
			}
		}
	</script>
	<script type="module">
		import 'bootstrap';
	</script>
</head>

<body>
	<header>
		<h1>Demo</h1>
	</header>
	<main>
		<section>
			<div class="container" data-controller="hello">
				<div data-hello-target="auth">
					Unauthenticated
				</div>
				<div data-hello-target="output">Placeholder</div>
				<input data-hello-target="name" type="text">
				<button data-action="click->hello#greet">Greet</button>
			</div>
		</section>
		<section>
			<div class="container" >
				<div id="load"></div>
			</div>
		</section>
	</main>
	<script type="module">
		import '@hotwired/turbo';
		Turbo.connectStreamSource(new EventSource("/stream"))
	</script>
	<script type="module">
		import { Application, Controller } from '@hotwired/stimulus';
		window.Stimulus = Application.start();

		Stimulus.register("hello", class extends Controller {
			static targets = ["name", "output", "auth"]
			initialize() {
				let hello = this;
				fetch("/user").then(response => {
					response.json().then(data => {
						hello.authTarget.textContent = `Logged in as: ${data.name}`;
					});
				});
			}
			greet() {
				this.outputTarget.textContent = `Hello, ${this.nameTarget.value}!`;
			};
		});
	</script>
</body>

</html>